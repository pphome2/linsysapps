#!/bin/bash
#
# port átengedés ssh tunnel-en
#


localdir=`dirname $0`
. $localdir/webcl-init

list=`ls webcl-*$PID_EXT 2>>/dev/null`
if [ ! -z $list ]; then
	for i in $list; do
		pid=`cat $i`
		run=`ps -A | grep $pid | awk {'print $1'}`
		#echo "PID: $pid -> $run"
		if [ -z "$run" ]; then
			bifs=$IFS
			IFS="-"
			x=( $i )
			y=${x[1]}
			IFS="."
			x=( $y )
			y=${x[0]}
			IFS=$bifs
			#echo $y
			#echo $y
			#$localdir/webcl-remote-server $y
			srv=`sudo lsof -i -n | egrep '\<'$TUN_SERVER_PORT'\>'`
			if [ -z "$srv" ]; then
				#echo $srv
				$localdir/webcl-remote-server $y
			fi
		fi
		#for x in ${!TUN_REMOTE_PORTS[@]}; do
		#	if [ "${TUN_REMOTE_PORTS[$x]}" == "$y" ]; then
		#		#echo $y
		#		#popen=`nmap $TUN_SERVER -p ${TUN_SERVER_BRIDGE_PORTS[$x]} | grep closed`
		#		#echo $popen
		#		popen=""
		#		if [ -z "$popen" ]; then
		#			echo $y > /dev/null
		#			#rm $i 2>/dev/null
		#			#kill -9 $pid 2>/dev/null
		#			#$localdir/webcl-remote-server $y
		#		fi
		#	fi
		#done
	done
else
	$localdir/webcl-remote-server $1
fi

#
