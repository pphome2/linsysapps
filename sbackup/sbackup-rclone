#!/bin/bash
#
# SBackup - rendszer
#
# Lokális gép mentése:
#
# - rclone gdrive-ba
#

d=`dirname $0`
. "$d/sbackup-init"

cd "$LOCALBACKUPDIR"

x=$OLDDAY
for b in $x; do
	if [ -z "$old" ]; then
		old="$b"
	fi
done

if [ -z "$old" ]; then
	old="."
fi

for v in *; do
	if [ ! -d "$v" ]; then
		if [ -f "$LOCALBACKUPDIR/$v" ]; then
			FS1=$(stat -c%s "$LOCALBACKUPDIR/$v")
		else
			FS1=0
		fi
		if [ -f "$LOCALBACKUPDIR/$old/$v" ]; then
			FS2=$(stat -c%s "$LOCALBACKUPDIR/$old/$v")
		else
			FS2=0
		fi
		if [ $FS1 != $FS2 ]; then
			#echo "$LOCALBACKUPDIR/$v" - "$FS1" - "$FS2"
			for e in $RCLONEONLYFILES; do
				if [[ $v == *"$e"* ]]; then
					#echo "$LOCALBACKUPDIR/$v" "$RCLONETARGET"
          			rclone copy "$LOCALBACKUPDIR/$v" "$RCLONETARGET" #>>"$LOGDIR/$LOGFILE" 2>/dev/null
          		fi
            done
  		fi
	fi
done

cd "$TPATH"

#
